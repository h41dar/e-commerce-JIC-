{% extends "index/master.html" %}
{% load static %}

{% block title %} EJIC| Transaction seller {% endblock %}

{% block content %}

<link rel="stylesheet" href="{% static 'column_canter_div.css' %}">
<div class="buttons">
    <button id="showPending">Pending</button>
    <button id="showCompleted">Completed</button>
</div>
<div class="body_transaction">
    {% for transaction in transactions %}
    <div class="transaction" data-status="{{ transaction.status }}">
        <div class="left">
            <div class="image_container">
                <img src="{{ transaction.item.image.url }}" alt="{{ item.image }}" class="item_image">
            </div>
        </div>
        <div class="right"> 
            <div class="group_details">
                <h3>Transaction id:</h3>
                <p>{{ transaction.transaction_id }}</p>
            </div>
            <div class="group_details">
                <h3>Title:</h3>
                <p>{{ transaction.item.title }}</p>
            </div>
            <div class="group_details">
                <h3>Price:</h3>
                <p>{{ transaction.item.price }} SAR</p>
            </div>
            <div class="group_details">
                <h3>The buyer: </h3>
                <p>{{ transaction.buyer }}</p>
            </div>    
            <div class="group_details">    
                <h3>The seller:</h3>
                <p>{{ transaction.seller }}</p>
            </div>
            <div class="group_details">    
                <h3>The seller phone:</h3>
                <p>{{ transaction.seller.phone_number }}</p>
            </div>    
            <div class="group_details">    
                <h3>Transaction date:</h3>
                <p>{{ transaction.transaction_date }}</p>
            </div>    
            <div class="group_details">
                <h3>Amount:</h3>
                <p>{{ transaction.amount }}</p>
            </div>    
            <div class="group_details">    
                <h3>Status:</h3>
                <p>{{ transaction.status }}</p>
            </div>
            <div class="group_details">    
                <h3>Code deliver:</h3>
                <p>{{ transaction.code_deliver }}</p>
            </div>

            {% if transaction.status == 'Completed' %}
                <a href="review/{{ transaction.transaction_id }}"><button class="inside">Review</button></a>
            {% elif transaction.status == 'Pending' %}
                <form method="post">{% csrf_token %}
                    <button class="inside" value="{{ transaction.transaction_id }}" name="Completed_button">Completed</button>
                </form>    
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
    // Get buttons
    const showPendingBtn = document.getElementById('showPending');
    const showCompletedBtn = document.getElementById('showCompleted');

    // Function to toggle visibility of transactions
    function toggleTransactions(statusToShow) {
        const transactions = document.querySelectorAll('.transaction');
        transactions.forEach(transaction => {
            const status = transaction.dataset.status; // Get data-status attribute
            if (status === statusToShow) {
                transaction.style.display = ''; // Show matching status
            } else {
                transaction.style.display = 'none'; // Hide others
            }
        });
    }

    // Event listeners for buttons
    showPendingBtn.addEventListener('click', () => toggleTransactions('Pending'));
    showCompletedBtn.addEventListener('click', () => toggleTransactions('Completed'));
</script>

{% endblock %}
